<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profil Peserta | PAGARNUSA UNUSIA</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1B7548',
                        primaryDark: '#145c38'
                    }
                }
            }
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        body { font-family: 'Poppins', sans-serif; }
    </style>
</head>
<body class="min-h-screen flex flex-col bg-gradient-to-b from-emerald-50 to-slate-50 text-slate-800">

    <header id="main-header" class="sticky top-0 z-50 bg-primary text-white shadow-lg">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <img src="logopn.png" alt="Logo" class="h-10">
                <h1 class="text-sm font-bold tracking-wide leading-tight uppercase">
                    PAGARNUSA<br>UNUSIA
                </h1>
            </div>
            <button id="logout-button" class="bg-white/20 hover:bg-white/30 px-4 py-1.5 rounded-lg text-xs font-semibold transition">
                <i class="fas fa-sign-out-alt mr-1"></i> Logout
            </button>
        </div>
    </header>

    <main class="flex-1 container mx-auto max-w-4xl px-4 py-8">
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div class="lg:col-span-1 space-y-6">
                <div class="bg-white rounded-2xl shadow-xl p-6 text-center border border-emerald-100">
<div class="w-24 h-24 bg-emerald-100 text-primary rounded-full mx-auto flex items-center justify-center overflow-hidden mb-4 border-2 border-primary">
    <img id="display-foto" src="" alt="Foto Profil" class="w-full h-full object-cover hidden">
    <i id="foto-icon-placeholder" class="fas fa-user text-3xl font-bold"></i>
</div>
                    <h2 id="display-nama" class="text-xl font-bold text-slate-800">Nama Peserta</h2>
                    <p id="display-email" class="text-sm text-slate-500 mb-4 italic">email@peserta.com</p>
                    
                    <div id="status-box" class="py-3 px-4 rounded-xl border-2 transition-all duration-500">
                        <p class="text-[10px] uppercase font-bold tracking-widest mb-1 opacity-70">Status Pendaftaran</p>
                        <p id="status-text" class="text-xl font-black italic uppercase italic tracking-tighter">Memuat...</p>
                    </div>
                </div>

                <div class="space-y-3">
                    <a href="pembayaran.html" class="flex items-center justify-between w-full bg-white p-4 rounded-xl shadow-sm border border-slate-200 hover:border-primary transition group">
                        <span class="text-sm font-semibold"><i class="fas fa-wallet mr-2 text-primary"></i> Konfirmasi Pembayaran</span>
                        <i class="fas fa-chevron-right text-xs text-slate-300 group-hover:text-primary transition"></i>
                    </a>
                </div>
            </div>

            <div class="lg:col-span-2 space-y-6">
                <div class="bg-white rounded-2xl shadow-xl p-8 border border-emerald-100">
                    <h3 class="text-lg font-bold text-primary border-b pb-4 mb-6 flex items-center">
                        <i class="fas fa-id-card mr-3"></i> Detail Profil Peserta
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <p class="text-xs text-slate-400 font-bold uppercase mb-1">Tempat, Tanggal Lahir</p>
                            <p id="display-ttl" class="text-sm font-medium text-slate-700">-</p>
                        </div>
                        <div>
                            <p class="text-xs text-slate-400 font-bold uppercase mb-1">Angkatan</p>
                            <p id="display-angkatan" class="text-sm font-medium text-slate-700">-</p>
                        </div>
                        <div class="md:col-span-2">
                            <p class="text-xs text-slate-400 font-bold uppercase mb-1">Alamat Lengkap</p>
                            <p id="display-alamat" class="text-sm font-medium text-slate-700">-</p>
                        </div>
                        <div>
                            <p class="text-xs text-slate-400 font-bold uppercase mb-1">WhatsApp</p>
                            <p id="display-whatsapp" class="text-sm font-medium text-slate-700">-</p>
                        </div>
                        <div>
                            <p class="text-xs text-slate-400 font-bold uppercase mb-1">Kategori Ujian</p>
                            <p id="display-ujian" class="text-sm font-medium text-slate-700">-</p>
                        </div>
                    </div>
                </div>

                <div id="sertifikat-section" class="bg-white rounded-2xl shadow-xl p-8 border border-emerald-100">
                    <h3 class="text-lg font-bold text-primary border-b pb-4 mb-6 flex items-center">
                        <i class="fas fa-certificate mr-3"></i> Sertifikat Kelulusan
                    </h3>
                    <div id="sertifikat-container" class="hidden text-center py-6">
                        <i class="fas fa-file-pdf text-5xl text-red-500 mb-4"></i>
                        <p class="text-sm mb-4">Sertifikat Anda telah tersedia dan dapat diunduh.</p>
                        <a id="download-sertifikat" href="#" target="_blank" class="inline-block bg-primary hover:bg-primaryDark text-white px-8 py-3 rounded-xl font-bold transition shadow-lg">
                            <i class="fas fa-download mr-2"></i> Unduh Sertifikat
                        </a>
                    </div>
                    <div id="sertifikat-placeholder" class="text-center py-10 bg-slate-50 rounded-xl border-2 border-dashed border-slate-200">
                        <p id="placeholder-text" class="text-slate-400 text-sm italic">Status pendaftaran belum disetujui.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-primary text-white text-center py-4 mt-8">
        <p class="text-xs opacity-80">© 2025 PAGARNUSA UNUSIA. Semua hak cipta dilindungi.</p>
    </footer>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // 1. Ambil Data Sesi Login
        const currentUser = JSON.parse(localStorage.getItem('currentUserProfile'));
        
        // Proteksi Halaman: Jika tidak login, tendang balik ke login.html
        if (!currentUser || currentUser.is_admin) {
            window.location.href = 'login.html';
            return;
        }

        // 2. Sinkronisasi Data Terbaru dari "Database" (localStorage)
        const allData = JSON.parse(localStorage.getItem('allStudentsData')) || [];
        const latestProfile = allData.find(s => s.email === currentUser.email) || currentUser;

        // 3. Isi Tampilan Profil (Teks)
        document.getElementById('display-nama').textContent = latestProfile.nama;
        document.getElementById('display-email').textContent = latestProfile.email;
        document.getElementById('display-ttl').textContent = latestProfile.ttl;
        document.getElementById('display-alamat').textContent = latestProfile.alamat;
        document.getElementById('display-whatsapp').textContent = latestProfile.whatsapp;
        document.getElementById('display-angkatan').textContent = latestProfile.angkatan;
        document.getElementById('display-ujian').textContent = latestProfile.ujian;

        // --- LOGIKA TAMPILAN FOTO ---
        const fotoElement = document.getElementById('display-foto');
        const iconPlaceholder = document.getElementById('foto-icon-placeholder');

        if (latestProfile.fotoUrl && latestProfile.fotoUrl.trim() !== "") {
            // Jika ada link foto, tampilkan img dan sembunyikan icon
            fotoElement.src = latestProfile.fotoUrl;
            fotoElement.classList.remove('hidden');
            iconPlaceholder.classList.add('hidden');
        } else {
            // Jika tidak ada foto, tampilkan icon default
            fotoElement.classList.add('hidden');
            iconPlaceholder.classList.remove('hidden');
        }

        // 4. Logika Tampilan Status & Sertifikat
        const statusBox = document.getElementById('status-box');
        const statusText = document.getElementById('status-text');
        const placeholderText = document.getElementById('placeholder-text');
        const sertifikatContainer = document.getElementById('sertifikat-container');
        const sertifikatPlaceholder = document.getElementById('sertifikat-placeholder');

        const currentStatus = latestProfile.status;

        if (currentStatus === 'Kualifikasi') {
            statusText.textContent = "Kualifikasi ✅";
            statusBox.className = "py-3 px-4 rounded-xl border-2 transition-all duration-500 bg-green-50 border-green-500 text-green-700";
            
            // Logika Link Sertifikat
            if (latestProfile.sertifikatUrl) {
                sertifikatContainer.classList.remove('hidden');
                sertifikatPlaceholder.classList.add('hidden');
                document.getElementById('download-sertifikat').href = latestProfile.sertifikatUrl;
            } else {
                placeholderText.textContent = "Sertifikat sedang dalam proses pembuatan.";
            }
        } else if (currentStatus === 'Diskualifikasi') {
            statusText.textContent = "Diskualifikasi ❌";
            statusBox.className = "py-3 px-4 rounded-xl border-2 transition-all duration-500 bg-red-50 border-red-500 text-red-700";
            placeholderText.textContent = "Mohon maaf, Anda tidak memenuhi kualifikasi.";
        } else {
            // Default: Pending
            statusText.textContent = "Pending ⏳";
            statusBox.className = "py-3 px-4 rounded-xl border-2 transition-all duration-500 bg-yellow-50 border-yellow-500 text-yellow-700";
            placeholderText.textContent = "Status Anda sedang ditinjau oleh Admin.";
        }

        // 5. Fungsi Logout
        document.getElementById('logout-button').addEventListener('click', () => {
            localStorage.removeItem('currentUserProfile');
            window.location.href = 'login.html';
        });
    });
</script>
</body>
</html>
