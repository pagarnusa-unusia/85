<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profil Peserta | PAGARNUSA UNUSIA</title>
    <link rel="icon" href="logopn.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1B7548',
                        primaryDark: '#145c38'
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f8fafc; }
        .glass-card { background: white; border-radius: 24px; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.05); border: 1px solid #f1f5f9; }
        .status-badge { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="sticky top-0 z-50 bg-primary text-white shadow-md">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <img src="logopn.png" alt="Logo" class="h-10">
                <div class="leading-tight">
                    <h1 class="text-sm font-bold uppercase tracking-wider">PAGARNUSA</h1>
                    <p class="text-[10px] opacity-80 uppercase tracking-widest">Unusia Jakarta</p>
                </div>
            </div>
            <button id="logout-button" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-xl text-xs font-bold transition-all flex items-center gap-2">
                <i class="fas fa-power-off"></i> <span>KELUAR</span>
            </button>
        </div>
    </header>

    <main class="flex-1 container mx-auto max-w-5xl px-4 py-10">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <div class="lg:col-span-4 space-y-6">
                <div class="glass-card p-8 text-center">
                    <div class="relative w-32 h-32 mx-auto mb-6">
                        <div class="w-full h-full bg-emerald-50 rounded-full flex items-center justify-center border-4 border-white shadow-inner overflow-hidden">
                            <img id="display-foto" src="" alt="Foto" class="w-full h-full object-cover hidden">
                            <i id="foto-placeholder" class="fas fa-user-circle text-6xl text-emerald-200"></i>
                        </div>
                        <div class="absolute bottom-1 right-1 w-8 h-8 bg-primary rounded-full border-4 border-white flex items-center justify-center">
                            <i class="fas fa-check text-[10px] text-white"></i>
                        </div>
                    </div>
                    
                    <h2 id="display-nama" class="text-xl font-bold text-slate-800 leading-tight">Memuat Nama...</h2>
                    <p id="display-email" class="text-xs text-slate-400 mb-6 font-medium tracking-wide">email@peserta.com</p>
                    
                    <div id="status-box" class="status-badge py-4 px-2 rounded-2xl border-2 bg-slate-50 border-slate-100">
                        <p class="text-[9px] uppercase font-black tracking-[0.2em] mb-1 text-slate-400">Status Peserta</p>
                        <p id="status-text" class="text-lg font-bold uppercase tracking-tight">Meninjau...</p>
                    </div>
                </div>

                <div class="glass-card p-4">

                    <a href="pembayaran.html" class="flex items-center justify-between w-full bg-white p-4 rounded-xl shadow-sm border border-slate-200 hover:border-primary transition group">

                        <span class="text-sm font-semibold"><i class="fas fa-wallet mr-2 text-primary"></i>Konfirmasi Pembayaran</span>
                        <i class="fas fa-external-link-alt text-xs opacity-50 group-hover:opacity-100"></i>
                    </a>
                </div>
                <div class="glass-card p-5">
                    <button onclick="bukaMateri()" class="flex items-center justify-between w-full bg-white p-4 rounded-xl shadow-sm border border-slate-200 hover:border-primary transition group">
                        <span class="text-sm font-semibold"><i class="fas fa-book mr-2 text-primary"></i>Materi Ujian</span>
                        <i class="fas fa-external-link-alt text-xs opacity-50 group-hover:opacity-100"></i>
                    </button>
                </div>
            </div>

            <div class="lg:col-span-8 space-y-8">
                <div class="glass-card p-8 lg:p-10">
                    <div class="flex items-center justify-between border-b border-slate-100 pb-6 mb-8">
                        <h3 class="text-lg font-bold text-slate-800 flex items-center gap-3">
                            <span class="w-2 h-6 bg-primary rounded-full"></span>
                            Biodata Lengkap
                        </h3>
                        <i class="fas fa-id-card text-slate-200 text-2xl"></i>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-y-8 gap-x-12 text-sm">
                        <div class="space-y-1">
                            <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Tempat, Tanggal Lahir</p>
                            <p id="display-ttl" class="font-semibold text-slate-700">-</p>
                        </div>
                        <div class="space-y-1">
                            <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Angkatan</p>
                            <p id="display-angkatan" class="font-semibold text-slate-700">-</p>
                        </div>
                        <div class="md:col-span-2 space-y-1">
                            <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Alamat Lengkap</p>
                            <p id="display-alamat" class="font-semibold text-slate-700 leading-relaxed">-</p>
                        </div>
                        <div class="space-y-1">
                            <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">No. WhatsApp</p>
                            <p id="display-whatsapp" class="font-semibold text-slate-700">-</p>
                        </div>
                        <div class="space-y-1">
                            <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Kategori Ujian</p>
                            <p id="display-ujian" class="font-semibold text-slate-700">-</p>
                        </div>
                    </div>
                </div>

                <div id="sertifikat-section" class="glass-card p-8 lg:p-10 overflow-hidden relative">
                    <div class="flex items-center justify-between border-b border-slate-100 pb-6 mb-8">
                        <h3 class="text-lg font-bold text-slate-800 flex items-center gap-3">
                            <span class="w-2 h-6 bg-primary rounded-full"></span>
                            E-Sertifikat
                        </h3>
                        <i class="fas fa-certificate text-slate-200 text-2xl"></i>
                    </div>

                    <div id="sertifikat-container" class="hidden animate-pulse">
                        <div class="flex flex-col md:flex-row items-center gap-8 bg-slate-50 p-6 rounded-3xl border border-slate-100">
                            <div class="w-20 h-20 bg-white rounded-2xl flex items-center justify-center shadow-sm">
                                <i class="fas fa-file-pdf text-4xl text-red-500"></i>
                            </div>
                            <div class="flex-1 text-center md:text-left">
                                <h4 class="font-bold text-slate-800">Sertifikat Kelulusan.pdf</h4>
                                <p class="text-xs text-slate-400">Sertifikat resmi UKT Pagar Nusa Unusia</p>
                            </div>
                            <a id="download-sertifikat" href="#" target="_blank" class="w-full md:w-auto bg-primary hover:bg-primaryDark text-white px-8 py-4 rounded-2xl font-bold transition-all shadow-lg shadow-emerald-900/20 text-center">
                                <i class="fas fa-download mr-2"></i> DOWNLOAD
                            </a>
                        </div>
                    </div>

                    <div id="sertifikat-placeholder" class="text-center py-12 bg-slate-50 rounded-3xl border-2 border-dashed border-slate-200">
                        <i class="fas fa-lock text-slate-200 text-4xl mb-4"></i>
                        <p id="placeholder-text" class="text-slate-400 text-xs font-medium italic">Status pendaftaran belum disetujui untuk akses sertifikat.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-white border-t border-slate-100 py-6 text-center">
        <p class="text-[10px] text-slate-400 font-bold uppercase tracking-[0.3em]">Pagar Nusa UNUSIA • Sistem Informasi Peserta</p>
    </footer>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // 1. Ambil Data Sesi Login dari LocalStorage
        const currentUser = JSON.parse(localStorage.getItem('currentUserProfile'));
        
        // Proteksi: Jika tidak ada data login, lempar kembali ke login.html
        if (!currentUser) {
            window.location.href = 'login.html';
            return;
        }

        // 2. Mapping Data ke UI (Mendukung Case Sensitive dari Excel)
        document.getElementById('display-nama').textContent = currentUser.nama || currentUser.Nama || "-";
        document.getElementById('display-email').textContent = currentUser.email || currentUser.Email || "-";
        document.getElementById('display-ttl').textContent = currentUser.ttl || currentUser.TTL || "-";
        document.getElementById('display-alamat').textContent = currentUser.alamat || currentUser.Alamat || "-";
        document.getElementById('display-whatsapp').textContent = currentUser.whatsapp || currentUser.Whatsapp || "-";
        document.getElementById('display-angkatan').textContent = currentUser.angkatan || currentUser.Angkatan || "-";
        document.getElementById('display-ujian').textContent = currentUser.ujian || currentUser.Ujian || "-";

        // 3. Logika Tampilan Foto (Sesuai kolom fotoUrl di Excel Anda)
        const imgEl = document.getElementById('display-foto');
        const placeholderEl = document.getElementById('foto-placeholder');
        const fotoUrl = currentUser.fotoUrl || currentUser.fotourl || "";

        // Jika fotoUrl berisi link asli (bukan kata 'default' atau kosong)
        if (fotoUrl && fotoUrl !== "default" && fotoUrl.length > 10) {
            imgEl.src = fotoUrl;
            imgEl.classList.remove('hidden');
            placeholderEl.classList.add('hidden');
        } else {
            // Jika foto kosong/default, buat avatar otomatis dari Nama
            const namaUser = currentUser.nama || "User";
            imgEl.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(namaUser)}&background=1B7548&color=fff&size=128`;
            imgEl.classList.remove('hidden');
            placeholderEl.classList.add('hidden');
        }

        // 4. Logika Status & Sertifikat (Mengatasi typo 'Panding' di Excel)
        const statusBox = document.getElementById('status-box');
        const statusText = document.getElementById('status-text');
        const certContainer = document.getElementById('sertifikat-container');
        const certPlaceholder = document.getElementById('sertifikat-placeholder');
        const placeholderText = document.getElementById('placeholder-text');

        const rawStatus = (currentUser.status || "Pending").toLowerCase();

        if (rawStatus.includes('kualifikasi') || rawStatus.includes('lulus')) {
            statusText.textContent = "Kualifikasi ✅";
            statusBox.className = "status-badge py-4 px-2 rounded-2xl border-2 bg-emerald-50 border-emerald-500 text-emerald-700";
            
            // Cek Link Sertifikat
            const sLink = currentUser.sertifikatUrl || currentUser.sertifikaturl;
            if (sLink && sLink.includes('http')) {
                certContainer.classList.remove('hidden');
                certPlaceholder.classList.add('hidden');
                document.getElementById('download-sertifikat').href = sLink;
            } else {
                placeholderText.textContent = "Sertifikat sedang dalam proses digitalisasi.";
            }
        } else if (rawStatus.includes('diskualifikasi') || rawStatus.includes('gagal')) {
            statusText.textContent = "Diskualifikasi ❌";
            statusBox.className = "status-badge py-4 px-2 rounded-2xl border-2 bg-red-50 border-red-500 text-red-700";
            placeholderText.textContent = "Mohon maaf, Anda tidak lolos tahap kualifikasi.";
        } else {
            // Untuk status 'Panding' atau 'Pending'
            statusText.textContent = "Sedang Ditinjau ⏳";
            statusBox.className = "status-badge py-4 px-2 rounded-2xl border-2 bg-yellow-50 border-yellow-500 text-yellow-700";
            placeholderText.textContent = "Berkas Anda sedang dalam pengecekan oleh admin.";
        }

        // 5. Fungsi Logout
        document.getElementById('logout-button').onclick = () => {
            localStorage.removeItem('currentUserProfile');
            window.location.href = 'login.html';
        };
    });
function bukaMateri() {
    const currentUser = JSON.parse(localStorage.getItem('currentUserProfile'));
    if (!currentUser) {
        window.location.href = 'login.html';
        return;
    }

    // Ambil data dari properti 'ujian' atau 'Ujian' atau 'kategori'
    // Menggunakan .toLowerCase() agar "putih" atau "Putih" tetap terbaca sama
    const rawTingkatan = currentUser.ujian || currentUser.Ujian || currentUser.kategori || "";
    const tingkatan = rawTingkatan.trim();

    if (tingkatan === "Putih") {
        window.location.href = 'materi_putih.html';
    } else if (tingkatan === "Kuning") {
        window.location.href = 'materi_kuning.html';
    } else if (tingkatan === "Merah") {
        window.location.href = 'materi_merah.html';
    } else if (tingkatan === "Biru") {
        window.location.href = 'materi_biru.html';
    } else {
        // Jika masih error, tampilkan isi datanya di alert untuk debug
        alert("Data tingkatan tidak ditemukan. Isi data: " + tingkatan);
    }
}
</script>
</body>
</html>


